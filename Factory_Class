import pgeocode #may need to be installed at the copmmand line
from collections import Counter
class Factory:
    #class of factory 
    def __init__(self,cost_weight,location):
        self.Factory_ID = None
        self.SKU_types = None #dict of all the SKUs in the factory and their quantites
        self.cost_weight = cost_weight #a multipler for how effiecent the factory is
        self.location = location #postcode of the factory
        self.fact_inv = None
    
    def Box_check(self,box_in):
        #function to check if a factory can complete an order
        check = all(item in box_in for item in self.SKU_types)
        return check
    
    def Cons_dist(self,order):
        #Function to find the Haversine distance between the factory and the order
        fact_dist = dist.query_postal_code(self.location, order.location)
        return fact_dist
    
    def SKU_Holding(self,inventory):
        #find all the unique items in the inventory
        holding_total ={}
        for dict_ in inventory:
                
                for key in dict_:
                    
                    if key in holding_total:
                          #add the value to the current total in the whole factory
                        holding_total[key] += dict_[key]
                    else:
                        #create a new entry if theres not currently a entry
                        holding_total[key] = dict_[key]
        self.fact_inv = holding_total
        self.SKU_types = holding_total.keys()

        
    def Get_FID(self,FID_dict):
        if self.location in FID_dict:
            self.Factory_ID = FID_dict[self.location]
        else:
            self.Factory_ID = len(FID_dict)
            FID_dict[self.location] = self.Factory_ID

